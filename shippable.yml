build_image:
  shippableimages/ubuntu1404_nodejs

language:
  node_js

node_js:
  - '4.1'

env:
  - XUNIT_FILE=shippable/testresults/result.xml

before_script:
  - sudo apt-get install -y --force-yes build-essential
  - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.28.0/install.sh | bash
  - source ~/.nvm/nvm.sh && nvm install $SHIPPABLE_NODE_VERSION
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - npm install

script:
  - npm run build
  - npm run review
  - npm run test

after_script:
  - node_modules/.bin/istanbul report cobertura --dir shippable/codecoverage/

after_success:
  - rm app/public/.gitignore
  - git add . && git commit -a -m 'added public'
  - git push -f git@heroku.com:opentrials-tracker.git master

notifications:
  email:
    - roll@respect31.com
